name: Manage Gists from JSON
run-name: Manage Gists from JSON

on:
  workflow_dispatch:
    inputs:
      operation:
        description: "Operation to perform"
        required: true
        default: "create"
        type: choice
        options:
          - get-gists
          - manage-gists

jobs:
  gist-manager:
    name: Execute Python Script to Manage Gists
    runs-on: ubuntu-latest

    # Required to push back to the repo â€” does NOT grant Gist access
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Required Python Packages
        run: |
          pip install --upgrade pip
          pip install requests

      - name: Get the list of Secret Gists
        id: get-gists
        if: ${{ github.event.inputs.operation == 'get-gists' }}
        shell: bash
        working-directory: ${{ github.workspace }}
        env:
          GITHUB_TOKEN: ${{ secrets.GIST_PAT }}  # âœ… Must have 'gist' scope
        run: |
          echo "ðŸ“¥ Fetching Secret Gists..."
          python get-list-of-gists.py

      - name: Run Gist Manager Script
        id: manage-gists
        if: ${{ github.event.inputs.operation == 'manage-gists' }}
        shell: bash
        working-directory: ${{ github.workspace }}
        env:
          GITHUB_TOKEN: ${{ secrets.GIST_PAT }}  # âœ… Must have 'gist' scope
        run: |
          python manage_gists.py

      - name: Commit Updated JSON File
        if: ${{ github.event.inputs.operation == 'manage-gists' }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add gists_input.json
          git commit -m "ðŸ”„ Update gists_input.json with Gist IDs and changes" || echo "No changes to commit"
          git push
